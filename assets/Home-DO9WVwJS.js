import{r as d,j as a,L as A,u as j}from"./index-CrX49Kll.js";import{A as x}from"./ApiService-D3B47Tee.js";function b(e){const[o,r]=d.useState([]),[c,s]=d.useState(!1),[l,n]=d.useState(null);return d.useEffect(()=>{let t=!0;async function u(){s(!0),n(null);try{let i=[];e!=null&&e.query?(i=await x.searchByName(e.query),e!=null&&e.region&&(i=i.filter(g=>g.region===e.region))):e!=null&&e.region?i=await x.filterByRegion(e.region):i=await x.getAll(),t&&r(i)}catch(i){t&&n(i)}finally{t&&s(!1)}}return u(),()=>{t=!1}},[e==null?void 0:e.query,e==null?void 0:e.region]),{countries:o,loading:c,error:l}}function C({country:e}){var o,r;return a.jsxs(A,{to:`/country/${e.cca3}`,className:"country-card","aria-label":`View ${e.name.common}`,children:[a.jsx("div",{className:"country-flag",children:(o=e.flags)!=null&&o.png?a.jsx("img",{loading:"lazy",src:e.flags.png,alt:`Flag of ${e.name.common}`}):null}),a.jsxs("div",{className:"country-info",children:[a.jsx("h3",{children:e.name.common}),a.jsxs("p",{children:[a.jsx("strong",{children:"Population:"})," ",((r=e.population)==null?void 0:r.toLocaleString())??"—"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Region:"})," ",e.region??"—"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Capital:"})," ",e.capital?e.capital.join(", "):"—"]})]})]})}function E(){const{region:e,setRegion:o}=j();return a.jsx("div",{className:"filters-bar",children:a.jsx("div",{className:"filter-region",children:a.jsxs("select",{value:e,"aria-label":"Filter by region",onChange:r=>o(r.target.value),children:[a.jsx("option",{value:"",children:"Filter by Region"}),a.jsx("option",{value:"Africa",children:"Africa"}),a.jsx("option",{value:"Americas",children:"America"}),a.jsx("option",{value:"Asia",children:"Asia"}),a.jsx("option",{value:"Europe",children:"Europe"}),a.jsx("option",{value:"Oceania",children:"Oceania"})]})})})}function S({page:e,totalPages:o,onNext:r,onPrev:c,onPage:s}){if(o<=1)return null;const l=[];for(let n=1;n<=o;n++)l.push(n);return a.jsx("nav",{"aria-label":"Pagination",className:"pagination",children:a.jsx("div",{className:"pagination-dots",children:l.map(n=>a.jsx("button",{onClick:()=>s(n),className:`pagination-dot ${n===e?"active":""}`,"aria-current":n===e?"page":void 0,"aria-label":`Page ${n}`},n))})})}function F(e,o=20){const[r,c]=d.useState(1),[s,l]=d.useState(o),n=d.useMemo(()=>Math.max(1,Math.ceil(e/s)),[e,s]);function t(){c(g=>Math.min(n,g+1))}function u(){c(g=>Math.max(1,g-1))}function i(){c(1)}return{page:r,perPage:s,setPage:c,setPerPage:l,totalPages:n,next:t,prev:u,reset:i}}function R(){const{query:e,region:o,sortBy:r,perPage:c,setPerPage:s}=j(),{countries:l,loading:n,error:t}=b({query:e,region:o});let u=l.slice();r==="name"?u.sort((m,p)=>m.name.common.localeCompare(p.name.common)):r==="population"&&u.sort((m,p)=>(p.population??0)-(m.population??0));const{page:i,perPage:g,totalPages:v,next:P,prev:f,setPage:N}=F(u.length,8),h=(i-1)*g,y=u.slice(h,h+g);return a.jsxs("main",{className:"rc-main",children:[a.jsx(E,{}),n&&a.jsx("p",{children:"Loading countries…"}),t&&a.jsxs("p",{role:"alert",children:["Error: ",t.message]}),a.jsx("div",{className:"cards-grid",children:y.map(m=>a.jsx(C,{country:m},m.cca3))}),a.jsx(S,{page:i,totalPages:v,onNext:P,onPrev:f,onPage:N})]})}export{R as default};
